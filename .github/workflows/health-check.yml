name: Health Check

on:
  schedule:
    # Run every 30 minutes
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  health-check:
    name: ðŸ¥ Server Health Check
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ¥ Check API Health
        run: |
          echo "Checking API health..."
          
          # Health check endpoint
          response=$(curl -s -o /dev/null -w "%{http_code}" http://${{ secrets.VPS_HOST }}:8000/api/health || echo "000")

          if [ "$response" == "200" ]; then
            echo "âœ… API is healthy (HTTP $response)"
            echo "status=healthy" >> $GITHUB_OUTPUT
          else
            echo "âŒ API is down or unhealthy (HTTP $response)"
            echo "status=unhealthy" >> $GITHUB_OUTPUT
            # Don't exit with non-zero here; handle notification in a separate conditional step
          fi
        id: health

      - name: ðŸ“Š Get API Stats
        if: always()
        run: |
          curl -s http://${{ secrets.VPS_HOST }}:8000/api/health || echo "Failed to get stats"

      # Notifications are disabled by request - no external alerts will be sent from this workflow

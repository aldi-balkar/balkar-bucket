name: Health Check

on:
  schedule:
    # Run every 30 minutes
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  health-check:
    name: ğŸ¥ Server Health Check
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ¥ Check API Health
        run: |
          echo "Checking API health..."
          
          # Health check endpoint
          response=$(curl -s -o /dev/null -w "%{http_code}" http://${{ secrets.VPS_HOST }}:8000/api/health || echo "000")
          
          if [ "$response" == "200" ]; then
            echo "âœ… API is healthy (HTTP $response)"
            echo "status=healthy" >> $GITHUB_OUTPUT
          else
            echo "âŒ API is down or unhealthy (HTTP $response)"
            echo "status=unhealthy" >> $GITHUB_OUTPUT
            exit 1
          fi
        id: health

      - name: ğŸ“Š Get API Stats
        if: always()
        run: |
          curl -s http://${{ secrets.VPS_HOST }}:8000/api/health || echo "Failed to get stats"

      - name: ğŸ”” Notify on Failure
        if: failure()
        run: |
          echo "âš ï¸ Health check failed! API is not responding."
          echo "Please check the server immediately."
          # Add notification integration here (Slack, Discord, Email, etc)
